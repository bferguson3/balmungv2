pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
--danmaku test
--(c)@tekkamansoul
fps=60

p={}
px=64
py=108
enemies={}
emitters={}
웃bullets={}
bullets={}

function _init()
 ⧗=0
 
 make웃()
 
 boss=makeenemy(64,24,1,1,20)
 
 makeemit(boss,2,270/360,0.15/fps,5,12,7,0)
 makeemit(boss,2,90/360,0.15/fps,5,12,7,0)
 makeemit(boss,4,0,0.1/fps,120,8,7,1)                   
 makeemit(boss,2,180/360,0.15/fps,5,14,7,0)
 makeemit(boss,2,0/360,0.15/fps,5,14,7,0)
end

function make웃()
 p.spr=5
end

function makeenemy(_x,_y,_s,_m,_l)
 e={x=_x,y=_y,spr=_s,mov=_m,t=_l}
 add(enemies,e)
 return e
end

function makeemit(n,_s,_an,_v,_dly,_c1,_c2,_loop)
 e={mom=n,x=n.x,y=n.y,shot=_s,an=_an,v=_v,dly=_dly,c1=_c1,c2=_c2,loop=_loop}
 add(emitters,e)
end

function loop(e)
 if e.loop==0 then
  e.an+=(3.5/360)
  if(⧗%e.dly==0)fire(e)
 elseif e.loop==1 then
  if ⧗%e.dly==0 then
   for j=0,16 do
    e.an=(j*22.5)/360
    fire(e)
   end
  elseif ⧗%e.dly==fps then
  for j=0.5,16.5 do
    e.an=(j*22.5)/360
    fire(e)
   end
  end 
 end
 empos(e)
end

function empos(e)
 e.x=e.mom.x
 e.y=e.mom.y
end

function fire(e)
 makebullet(e.shot,e.x,e.y,e.an,e.v,e.c1,e.c2)
end

function makebullet(_sp,_x,_y,_an,_v,_c1,_c2)
 b={sp=_sp,x=_x,y=_y,v=_v,c1=_c1,c2=_c2}
 b.r=1--radius of bullet
 if _sp==3 then
  b.r=2
 elseif _sp==4 then
  b.r=3
 end
 b.tx=cos(_an)*200
 b.ty=sin(_an)*200
 add(bullets,b)
end

function movebullet(b)
 b.x+=b.tx*b.v
 b.y+=b.ty*b.v
 if b.x>128 or b.y>128 or b.x<-8 or b.y<-8 then del(bullets,b) end
 if b.y<-8 then del(웃bullets,b) end
end

function _update60()
 ⧗+=1
 for e in all(emitters) do
  loop(e)
 end
 for b in all(bullets) do
  movebullet(b)
 end
 for b in all(웃bullets) do
  movebullet(b)
 end
 move웃()
 fire웃()
 move🐱()
end

function fire웃()
 if btn(4) and ⧗%6==0 then
  for i=-0.02,0.02,0.02 do
   b={x=px,y=py-5,v=0.8/fps,
   tx=cos(0.25+i)*200,
   ty=sin(0.25+i)*200}
   add(웃bullets,b) 
  end
 end
end

function move🐱()
 for e in all(enemies) do
  if e.mov==1 then --backandforth
   if ⧗%(fps*e.t)>(fps*e.t*0.75) and e.x<112 then
    e.x+=30/fps
   elseif ⧗%(fps*e.t)>(fps*e.t*0.5) and e.x<64 then
    e.x+=30/fps
   elseif ⧗%(fps*e.t)>(fps*e.t*0.25) and e.x>16 then
    e.x-=30/fps
   elseif ⧗%(fps*e.t)>0 and (e.x<64 or e.x>64) then
    if(e.x<64)e.x+=30/fps
    if(e.x>64)e.x-=30/fps
   end
  end
 end
end

function collide웃()
 for a in all(bullets) do
  local dx=(a.x+4)-(px+4)
  local dy=(a.y+4)-(py+4)
  local r2=a.r+1
  if((dx*dx)+(dy*dy)<(r2*r2))then
   del(bullets,a)
   sfx(0)
  end
 end  
end

function move웃()
 local spd=60
 if btn(5) then spd=30 end
 if btn(0) then
  px-=spd/fps
 end
 if btn(1) then
  px+=spd/fps
 end
 if btn(2) then
  py-=spd/fps
 end
 if btn(3) then
  py+=spd/fps
 end
end

function _draw()
 cls()
 
 for e in all(enemies) do
  spr(e.spr,e.x,e.y)
 end

 for b in all(웃bullets) do
  spr(7,b.x,b.y)
 end
 
 if ⧗%15>7.5 then p.spr=6 else p.spr=5 end
 spr(p.spr,px,py)
 
 for b in all(bullets) do
  pal(12,b.c1)
  pal(7,b.c2)
  spr(b.sp,b.x,b.y)
 end
 pal()
 
 if(btn(5))drawhitbox()
 
 collide웃()
 
 debug()
end

function drawhitbox()
 local c=7
 if ⧗%8>4 then c=11 end
 for i=-1,1 do
   pset(px+4+i,py+4,c)
   pset(px+4,py+4+i,c)
 end
 c=3
 for i=-1,1,2 do
  for j=-1,1,2 do
    pset(px+4+i, py+4+j,c)
  end
 end
end

function debug()
 print("cpu:"..flr((stat(1)*100)).."% fps:"..stat(7).." bullets:"..#bullets,5,115,7)
end
__gfx__
0000000000000000000000000000000000000000000040f0000099f0000005000000000000000000000000000000000000000000000000000000000000000000
00000000005555000000000000000000000ccc00000499e000049ae0000005000000000000000000000000000000000000000000000000000000000000000000
00700700052ff25000000000000ccc0000c777c00009998000099980000050500000000000000000000000000000000000000000000000000000000000000000
0007700005f22f500000c00000c777c00c77777c0000a99000099900000050500000000000000000000000000000000000000000000000000000000000000000
0007700005f22f50000c7c0000c777c00c77777c000e2aa00009aae0000050500000000000000000000000000000000000000000000000000000000000000000
00700700052ff2500000c00000c777c00c77777c0002ee200002ee20000505050000000000000000000000000000000000000000000000000000000000000000
000000000055550000000000000ccc0000c777c000e2e2ee00ee2e22000005000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000ccc000000220000002200000005000000000000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ee000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e77e00000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e77e00000000000
000000000000000000000000000000000000000000000000000000000000000088880000000000000000000000000000000000000000000000ee000000000000
0000000000000000000000000000000000000000000ee00000000000000000088778800000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000e77e0000000000000000887777880000000000000000000000000000000000000000000000000000000000
000000000888800000000000000000000000000000e77e0000000000000000877777780000000000000000000000000000000000000000000000008888000000
0000000088778800000000000000000000000000000ee00000000000000000877777780000000000000000000000000000000000000000000000088778800000
0000000887777880000000000000000000000000008888000000000000000088777788000000000000000888800000000000000000000000000088777788000e
000000087777778000000000000000000000000008877880000000000000000887788000000000000000887788000000000000000000000000008777777800e7
000000087777778000000000000000000000000088777788000000000000000088880000000000000008877778800000000000000000000000008777777800e7
00000008877778800000000000000000000ee000877777780000000000000000000000000000000000087777778000000000000000000000000088777788000e
0000000088778800000000000000000000e77e008777777800000000000000000000000000000000000877777780000000000000000000000000088778800000
0000000008888000000000000000000000e77e008877778800000000000000000000000000000000000887777880000000000000000000000000008888000000
00000000000000000000000000000000000ee0000887788000000000000000000000000000000000000088778800000000000000000000000000000000000000
00000000000000000000000000000000000000000088880000000000000000000000000000000000000008888000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000ee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000088880e77e000000000000000000000000000000000000000000000000000000000000000000000000888800000000000000000000
0000000000000000000000887788e77e000000000000000000000000000000000000000000000000000000000000000000000008877880000000000000000000
00000000000000000000088777788ee0000000000000000000000000000000000000000000000000000000000000000000000088777788000000000000000000
00000000000000000000087777778000000000000000000000000000000000008888000000000000000000000000000000000087777778000000000000000000
00000000000000000000087777778000000000000000000000000000000000088778800000000000000000000000000000000087777778000000000000000000
00000000000000000000088777788000000000000000000000000000000000887777880000000000000000000000000000000088777788000000000000000000
00000000000000000000008877880000000000000000000008888000000000877777780000000088880000000000000000000008877880000000000000000000
00000000000000000000000888800000000000000000000088778800000000877777780000000887788000000000000000000000888800000000000000000000
0000000000000000000000000ee00000000000000000000887777880000000887777880000008877778800000000000000000000000000000000000000000000
000000000000000000000000e77e0000000000000000000877777780000000088778800000008777777800000000000000000000000000000000000000000000
000000000000000000000000e77e0000000000000000000877777780000000008888000000008777777800000000000000000000000000000000000000000000
0000000000000000000000000ee00000000000000000000887777880000000000000000000008877778800000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000088778800000000000000000000000887788000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000008888000000000000000000000000088880000000000000000000000000000000000000000000000
00000000000000000000000000000000000008888000000000000000000000000000000000000000000000000088880000000000000000000000000000000000
00000000000000000000000000000000000088778800000000000000000000000000000000000000000000000887788000000000000000000000000000000000
00000000000000000000000000000000000887777880000000000000000000000000000000000000000000008877778800000000000000000000000000000000
0000000000000000000000ee00000000000877777780000000000000000000000000000000000000000000008777777800000000000000000000000000000000
000000000000000000000e77e0000000000877777780000000000000000000000000000000000000000000008777777800000000000000000000000000000000
000000000008888000000e77e0000000000887777880000000000000000000000000000000000000000000008877778800000000000000000000888800000000
0000000000887788000000ee00000000000088778800000000000000000000000000000000000000000000000887788000000000000000000008877880000000
00000000088777788000000000000000000008888000000000000000000000000000000000000000000000000088880000000000000000000088777788000000
00000000087777778000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000087777778000000
00000000087777778000000000000000000000000000000000000000000000008888000000000000000000000000000000000000000000000087777778000000
00000000088777788000000000000000000000000000000000000000000000088778800000000000000000000000000000000000000000000088777788000000
0000000000887788000000ee0000000000000000000000000000000008888088777788888800cc00000000000000000000000000000000000008877880000000
000000000008888000000e77e0000888800000000000000000000000887788877777788cc88c77c00cc000000000000000888800000000000000888800000000
000000000000000000000e77e000887788000000000000000000000887777887777778c77c8c77c0c77c00cc0000000008877880000000000000000000000000
0000000000000000000000ee0008877778800000000000000008888877777788777cc8c77c78cc88c77c0c77c000000088777788000000000000000000000000
000000000000000000000000000877777780000000000000008877887777778887c77c7cc77887788cc00c77c000000087777778000000000000000000000000
000000000000000000000000000877777780000000000000088777788777788088c77c7777887777880000cc0000000087777778000000000000000000000000
0000000000000000000000000008877778800000000000000877777788778800cc0cc8877887777778000000000cc00088777788000000000000000000000000
000000000000000000000000000088778800000000000000087777778888800c77c00088888777777800000000c77c0008877880000000000000000000000000
00000000000000000000000ee00008888000000000000000088777788000000c77c00000008877778800000000c77c0000888800000000000000000000000000
0000000000000000000000e77e0000000000000000000000888877880000000ccc0000000008877888800000000cc00000000000000000000000000000000000
0000000000000000000000e77e000000000000000000000887788880000000c77c00000000008888778800000000000cc0000000000000000000000000000000
00000000000000000000000ee0000000000000000000008877778800000000c77c0000000000088777788000000000c77c000000000000000000000000000000
00000000000000000000000000000000000000000000008777777800000000ccc00000000000087777778000000000c77c000000000000000000000000000000
0000000000000000000000000000000000000000000000877777780000000c77c000000000000877777780000000000cc0000000000000000000000000000000
0000000000000000000000000000000000000000000000887777880000000c77c000000000000887777880000000000000000000000000000000000000000000
00000000000000000000000000ee0000000000000000000887788000000000cc5500000000000088778800000000000000000000000000000000000000000000
0000008888000000000000000e77e8000000000000000088888800000000052ff2500000000000088888800000000000000cc888800000000000000008888000
0000088778800000000000000e77e880000000000000088778800000000005f22f50000000000000887788000000000000c77c77880000000000000088778800
00008877778800000000000088ee7788000000000000887777880000000005f22f50000000000008877778800000000000c77c77788000000000000887777880
000087777778000000000000877777780000000000008777777800000000052ee2500000000000087777778000000000000cc777778000000000000877777780
00008777777800000000000087777778000000000000877777780000000000e77e00000000000008777777800000000000087777778000000000000877777780
000088777788000000000000887777ee000000000000887777880000000000e77e00000000000008877778800000000000088777788000000000000887777880
00000887788000000000000008877e77e00000000000088788880000000000eee000000000000008887788000000000000008877880000000000000088778800
00000088880000000000000000888e77e0000000000000888778800000000e77e0000000000000887888800000000000000008cc800000000000000008888000
000000000000000000000000000000ee00000000000000887777880000000e77e000000000000887777880000000000000000c77c00000000000000000000000
0000000000000000000000000000000000ee0000000000877777780000000eee0000000000000877777780000000000000000c77c00000000000000000000000
000000000000000000000000000000000e77e00000000087777778000000e77e00000000000008777777800000000000000000cc000000000000000000000000
000000000000000000000000000000000e77e00000000088777788000000e77e0000000000000887777880000000000000000000000000000000000000000000
0000000000000000000000000000000000ee0000000000088778888000ee0ee00000000000008888778800000000000000000000000000000000000000000000
000000000000000000000000000000000000000ee0000000888877880e77e0000000000000088778888000000000000000000000000000000000000000000000
00000000000000000000000000000888800000e77e00ee00088777ee8e77e0000000000000887777880000000000000000888800000000000000000000000000
00000000000000000000000000008877880000e77e0e77e00ee77e77e8ee8000000000888887777778000000000000000887788cc00000000000000000000000
000000000000000000000000000887777880000ee00e77e0e77e7e77e877880000000887788777777800000000000000887777c77c0000000000000000000000
00000000000000000000000000087777778000000000ee00e77e77ee8777788088888877778877778800000000000000877777c77c0000000000000000000000
0000000000000000000000000008777777800000000000000ee8778877777788877887777778877880000000000000008777777cc00000000000000000000000
00000000000000000000000000088777788000000000000000088888777777887777877777788888000000000000000088777788000000000000000000000000
00000000000000000000000000008877880000000000000000000008877778877777887777880000000000000000000008877880000000000000000000000000
00000000000888800000000000000888800000000000000000000000887788877777788778800000000000000000000000888800000000000000888800000000
00000000008877880000000000000000000000000000000000000000088880887777888888000000000000000000000000000000000000000008877880000000
0000000008877778800000000000000000000000000000000000000000000008877880000000000000000000000000000000000cc00000000088777788000000
000000000877777780000000000000000000000000000000000000000000000088880000000000000000000000000000000000c77c0000000087777778000000
000000000877777780000000000000000000000000000000000000000000000000000000000000000000000000000000000000c77c0000000087777778000000
0000000008877778800000000000000000000888800000000000000000000000000000000000000000000000008888000000000cc00000000088777788000000
00000000008877880000000000000000000088778800000000000000000000000000000000000000000000000887788000000000000000000008877880000000
00000000000888800000000000000000000887777880000000000000000000000000000000000000000000008877778800000000000000000000888800000000
00000000000000000000000000000000000877777780000000000000000000000000000000000000000000008777777800000000000000000000000000000000
00000000000000000000000000000000000877777780000000000000000000000000000000000000000000008777777800000000000000000000000000000000
00000000000000000000000000000000000887777880000000000000000000000000000000000000000000008877778800000000000000000000000000000000
0000000000000000000000000000000000008877880000000000000000000000000000000000000000000000088778800000cc00000000000000000000000000
000000000000000000000000000000000000088880000000000000000000000000000000000000000000000000888800000c77c0000000000000000000000000
000000000000000000000000000000000000000000000000088880000000000000000000000000888800000000000000000c77c0000000000000000000000000
0000000000000000000000000000000000000000000000008877880000000000000000000000088778800000000000000000cc00000000000000000000000000
00000000000000000000000000000000000000000000000887777880000000000000000000008877778800000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000877777780000000008888000000008777777800000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000877777780000000088778800000008777777800000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000887777880000000887777880000008877778800000000000000000000000000000000000000000000
00000000000000000000000888800000000000000000000088778800000000877777780000000887788000000000000000000000888800000000000000000000
000000000000000000000088778800000000000000000000088880000000008777777800000000888800000000000000cc000008877880000000000000000000
00000000000000000000088777788000000000000000000000000000000000887777880000000000000000000000000c77c00088777788000000000000000000
00000000000000000000087777778000000000000000000000000000000000088778800000000000000000000000000c77c00087777778000000000000000000
000000000000000000000877777780000000000000000000000000000000000088880000000000000000000000000000cc000087777778000000000000000000
00000000000000000000088777788000000000000000000000000000000000000000000000000000000000000000000000000088777788000000000000000000
00000000000000000000008877880000000000000000000000000000000000000000000000000000000000000000000000000008877880000000000000000000
00000000000000000000000888800000000000000000000000000000000000000000000000000000000000000000000000000000888800000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cc000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c77c00000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c77c00000000000000000000000000000000000
000000000000000000000000000000000000000000888800000000000000000000000000000000000000088880cc000000000000000000000000000000000000
00000077077707070000077707770707000007770777787700000700077700000000000000000000000088778800000000000000000000000000000000000000
00000700078787070070000707070007000007008777778800700700070700000000000000000000000887777880000000000000000000000000008888000000
00000700877787070000077707070070000007708777777700000777070700000000000000000000000877777780000000000000000000000000088778800000
0000070887777787007007000707070000000700877777770070070707070000000000000000000000cc77777780000000000000000000000000887777880000
000000777777777700000777077707070000070087777778000007770777000088880000000000000c77c7777880000000000000000000000000877777780000
000000087777778000000000000000000000000008877880000000000000000887788000000000000c77c8778800000000000000000000000000877777780000
0000000887777880000000000000000000000000008888000000000000000088777788000000000000cc08888000000000000000000000000000887777880000
00000000887cc8000000000000000000000000000000000000000000000000877777780000000000000000000000000000000000000000000000088778800000
0000000008c77c000000000000000000000000000000000000000000000000877777780000000000000000000000000000000000000000000000008888000000
0000000000c77c00000000000000000000000000000000000000000000000088777788000cc00000000000000000000000000000000000000000000000000000
00000000000cc00000000000000000000000000000000000000000000000000887788000c77c0000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000088880000c77c0000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000cc00000000000000000000000000000000000000000000000000000

__gff__
0000008080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
00010000000001375014750187501c75018750137500e7500905008750067500a0500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
